(function() {
  var extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    hasProp = {}.hasOwnProperty;

  window.AreaGraph = (function(superClass) {
    extend(AreaGraph, superClass);

    AreaGraph.prototype.colors = ['#ec008c', '#b3b3b3', '#249eb2', '#249eb2', '#9ac8e2', '#f2d1d9'];

    function AreaGraph($ele, graphData, chartType, isMultiLayer) {
      this.$ele = $ele;
      this.graphData = graphData;
      this.chartType = chartType != null ? chartType : "Pie";
      this.isMultiLayer = isMultiLayer != null ? isMultiLayer : true;
      this.redrawOnResize = true;
      this.margin = {
        left: 20,
        right: 15,
        top: 15,
        bottom: 20
      };
      AreaGraph.__super__.constructor.call(this, this.$ele, this.graphData);
    }

    AreaGraph.prototype.onRender = function() {
      var ageGroup, area, autoDomainCalc, colorScale, firstTick, grpdGraphData, height, hoverLabel, lastTick, legendHeight, ref, textOffsetCorrection, xAxisTicks, xBar, xDomain, xScale, yAxis, yDomain, yScale, yaxisTextWidth;
      legendHeight = this.drawLegends(this.graphData.labels, this.colors);
      height = this.height - legendHeight - 20;
      yScale = d3.scale.linear().range([height, 0]);
      xScale = d3.scale.linear().range([0, this.width]);
      colorScale = d3.scale.ordinal().range(this.graphData.colors || this.colors);
      hoverLabel = d3.scale.ordinal().range(this.graphData.labels);
      yAxis = d3.svg.axis().scale(yScale).tickSize(-this.width - 5, 0, 0).ticks(5).tickFormat(function(d, index) {
        if (index === 0) {
          return '';
        } else {
          return d;
        }
      }).orient('left');
      xBar = d3.svg.axis().scale(xScale).ticks(this.graphData.data.length - 1).tickSize(height, 0, 0).tickFormat((function(_this) {
        return function(d, index) {
          return _this.graphData.data[index].label.toUpperCase();
        };
      })(this)).orient('bottom');
      grpdGraphData = this.graphData.labels.map((function(_this) {
        return function(n) {
          return _this.graphData.data.map(function(d, i) {
            return {
              x: i,
              y: d[n],
              y0: 0
            };
          });
        };
      })(this));
      d3.layout.stack()(grpdGraphData);
      autoDomainCalc = (function(_this) {
        return function(axis) {
          var callback, isString;
          isString = false;
          if (typeof _this.graphData.data[0][axis] === "string") {
            isString = true;
          }
          callback = function(d, index) {
            var k, sum, v;
            if (isString) {
              return index;
            }
            sum = 0;
            for (k in d) {
              v = d[k];
              if (k === 'label') {
                continue;
              }
              sum += v;
            }
            return sum;
          };
          return [0, d3.max(_this.graphData.data, callback) * 1.1];
        };
      })(this);
      xDomain = [0, this.graphData.data.length - 1];
      yDomain = autoDomainCalc('y');
      xScale.domain(xDomain);
      yScale.domain(yDomain);
      this.graphGrp.append('g').attr('class', 'xaxis').attr('transform', 'translate(0,' + 0 + ')').call(xBar);
      this.graphGrp.append('g').attr('class', 'yaxis').call(yAxis);
      if (this.phaseCount === 0) {
        this.phaseCount = 1;
        yaxisTextWidth = [];
        this.graphGrp.selectAll('g.yaxis').selectAll('text').each(function() {
          var self, textLength;
          self = d3.select(this);
          textLength = self.node().getComputedTextLength();
          yaxisTextWidth.push(textLength);
        });
        textOffsetCorrection = d3.max(yaxisTextWidth);
        this.margin.left = this.marginOriginal.left + textOffsetCorrection;
        this.width = this.widthOriginal - textOffsetCorrection / 2.0;
        this.resetDimension();
        this.redraw();
        return;
      }
      this.phaseCount = 0;
      area = d3.svg.area().x(function(d) {
        return xScale(d.x);
      }).y0(function(d) {
        return yScale(d.y0);
      }).y1(function(d) {
        return yScale(d.y + d.y0);
      });
      ageGroup = this.graphGrp.selectAll('.valgroup').data(grpdGraphData).enter().append('g').attr('class', 'valgroup').style('fill', function(d, i) {
        return colorScale(i);
      }).attr('class', function(d, i) {
        return hoverLabel(i);
      });
      ageGroup.append('path').attr('d', function(d) {
        return area(d);
      });
      xAxisTicks = this.svgEle.selectAll('.xaxis .tick line');
      ref = xAxisTicks[0], firstTick = ref[0], lastTick = ref[ref.length - 1];
      d3.select(firstTick).attr("transform", "translate(1,0)");
      return d3.select(lastTick).attr("transform", "translate(-1,0)");
    };

    return AreaGraph;

  })(Graph);

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndpZGdldHMvYXJlYWdyYXBoLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUFBLE1BQUE7K0JBQUE7O0FBQUEsRUFBTSxNQUFNLENBQUM7QUFDVCxpQ0FBQSxDQUFBOztBQUFBLHdCQUFBLE1BQUEsR0FBUyxDQUNMLFNBREssRUFFTCxTQUZLLEVBR0wsU0FISyxFQUlMLFNBSkssRUFLTCxTQUxLLEVBTUwsU0FOSyxDQUFULENBQUE7O0FBUVksSUFBQSxtQkFBQyxJQUFELEVBQU8sU0FBUCxFQUFrQixTQUFsQixFQUFtQyxZQUFuQyxHQUFBO0FBRVIsTUFGUyxJQUFDLENBQUEsT0FBRCxJQUVULENBQUE7QUFBQSxNQUZlLElBQUMsQ0FBQSxZQUFELFNBRWYsQ0FBQTtBQUFBLE1BRjBCLElBQUMsQ0FBQSxnQ0FBRCxZQUFXLEtBRXJDLENBQUE7QUFBQSxNQUYyQyxJQUFDLENBQUEsc0NBQUQsZUFBYyxJQUV6RCxDQUFBO0FBQUEsTUFBQSxJQUFDLENBQUEsY0FBRCxHQUFrQixJQUFsQixDQUFBO0FBQUEsTUFFQSxJQUFDLENBQUEsTUFBRCxHQUFXO0FBQUEsUUFDUCxJQUFBLEVBQVMsRUFERjtBQUFBLFFBRVAsS0FBQSxFQUFTLEVBRkY7QUFBQSxRQUdQLEdBQUEsRUFBUyxFQUhGO0FBQUEsUUFJUCxNQUFBLEVBQVMsRUFKRjtPQUZYLENBQUE7QUFBQSxNQVVBLDJDQUFNLElBQUMsQ0FBQSxJQUFQLEVBQVksSUFBQyxDQUFBLFNBQWIsQ0FWQSxDQUZRO0lBQUEsQ0FSWjs7QUFBQSx3QkF3QkEsUUFBQSxHQUFXLFNBQUEsR0FBQTtBQUVQLFVBQUEsc05BQUE7QUFBQSxNQUFBLFlBQUEsR0FBZSxJQUFDLENBQUEsV0FBRCxDQUFhLElBQUMsQ0FBQSxTQUFTLENBQUMsTUFBeEIsRUFBK0IsSUFBQyxDQUFBLE1BQWhDLENBQWYsQ0FBQTtBQUFBLE1BQ0EsTUFBQSxHQUFTLElBQUMsQ0FBQSxNQUFELEdBQVUsWUFBVixHQUF5QixFQURsQyxD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SUFBQSxDQUFLLENBQUwsRUFEOEI7TUFBQSxDQUFsQyxDQXRIQSxDQUFBO0FBQUEsTUEwSEEsVUFBQSxHQUFhLElBQUMsQ0FBQSxNQUFNLENBQUMsU0FBUixDQUFrQixtQkFBbEIsQ0ExSGIsQ0FBQTtBQUFBLE1BMkhBLE1BQThCLFVBQVcsQ0FBQSxDQUFBLENBQXpDLEVBQUMsa0JBQUQsRUFBaUIsOEJBM0hqQixDQUFBO0FBQUEsTUE0SEEsRUFBRSxDQUFDLE1BQUgsQ0FBVSxTQUFWLENBQW9CLENBQUMsSUFBckIsQ0FBMEIsV0FBMUIsRUFBdUMsZ0JBQXZDLENBNUhBLENBQUE7YUE2SEEsRUFBRSxDQUFDLE1BQUgsQ0FBVSxRQUFWLENBQW1CLENBQUMsSUFBcEIsQ0FBeUIsV0FBekIsRUFBc0MsaUJBQXRDLEVBL0hPO0lBQUEsQ0F4QlgsQ0FBQTs7cUJBQUE7O0tBRDJCLE1BQS9CLENBQUE7QUFBQSIsImZpbGUiOiJ3aWRnZXRzL2FyZWFncmFwaC5qcyIsInNvdXJjZVJvb3QiOiIvc291cmNlLyIsInNvdXJjZXNDb250ZW50IjpbImNsYXNzIHdpbmRvdy5BcmVhR3JhcGggZXh0ZW5kcyBHcmFwaFxuICAgIGNvbG9ycyA6IFtcbiAgICAgICAgJyNlYzAwOGMnXG4gICAgICAgICcjYjNiM2IzJ1xuICAgICAgICAnIzI0OWViMidcbiAgICAgICAgJyMyNDllYjInXG4gICAgICAgICcjOWFjOGUyJ1xuICAgICAgICAnI2YyZDFkOSdcbiAgICBdXG4gICAgY29uc3RydWN0b3I6KEAkZWxlLEBncmFwaERhdGEsQGNoYXJ0VHlwZT1cIlBpZVwiLEBpc011bHRpTGF5ZXI9dHJ1ZSktPlxuXG4gICAgICAgIEByZWRyYXdPblJlc2l6ZSA9IHRydWVcblxuICAgICAgICBAbWFyZ2luID0gIHtcbiAgICAgICAgICAgIGxlZnQgICA6IDIwXG4gICAgICAgICAgICByaWdodCAgOiAxNVxuICAgICAgICAgICAgdG9wICAgIDogMTVcbiAgICAgICAgICAgIGJvdHRvbSA6IDIwXG4gICAgICAgIH1cblxuXG4gICAgICAgIHN1cGVyIEAkZWxlLEBncmFwaERhdGFcblxuXG5cbiAgICBvblJlbmRlciA6IC0+XG5cbiAgICAgICAgbGVnZW5kSGVpZ2h0ID0gQGRyYXdMZWdlbmRzKEBncmFwaERhdGEubGFiZWxzLEBjb2xvcnMpXG4gICAgICAgIGhlaWdodCA9IEBoZWlnaHQgLSBsZWdlbmRIZWlnaHQgLSAyMFxuICAgICAgICAjIG1ha2UgZHluYW1pY1xuICAgICAgICB5U2NhbGUgPSBkMy5zY2FsZS5saW5lYXIoKS5yYW5nZShbaGVpZ2h0LDBdKVxuXG4gICAgICAgIHhTY2FsZSA9IGQzLnNjYWxlLmxpbmVhcigpLnJhbmdlKFtcbiAgICAgICAgICAgIDBcbiAgICAgICAgICAgIEB3aWR0aFxuICAgICAgICBdKVxuXG4gICAgICAgIGNvbG9yU2NhbGUgPSBkMy5zY2FsZS5vcmRpbmFsKCkucmFuZ2UoQGdyYXBoRGF0YS5jb2xvcnMgfHwgQGNvbG9ycylcblxuICAgICAgICBob3ZlckxhYmVsID0gZDMuc2NhbGUub3JkaW5hbCgpLnJhbmdlKEBncmFwaERhdGEubGFiZWxzKVxuXG4gICAgICAgIHlBeGlzID0gZDMuc3ZnXG4gICAgICAgICAgICAuYXhpcygpXG4gICAgICAgICAgICAuc2NhbGUoeVNjYWxlKVxuICAgICAgICAgICAgLnRpY2tTaXplKC1Ad2lkdGggLSA1LCAwLCAwKVxuICAgICAgICAgICAgLnRpY2tzKDUpXG4gICAgICAgICAgICAudGlja0Zvcm1hdCgoZCwgaW5kZXgpIC0+XG4gICAgICAgICAgICAgICAgaWYgaW5kZXggPT0gMFxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJydcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkXG4gICAgICAgICAgICApLm9yaWVudCgnbGVmdCcpXG5cbiAgICAgICAgeEJhciA9IGQzLnN2Z1xuICAgICAgICAgICAgLmF4aXMoKVxuICAgICAgICAgICAgLnNjYWxlKHhTY2FsZSlcbiAgICAgICAgICAgIC50aWNrcyhAZ3JhcGhEYXRhLmRhdGEubGVuZ3RoLTEpXG4gICAgICAgICAgICAudGlja1NpemUoaGVpZ2h0ICwgMCwgMClcbiAgICAgICAgICAgIC50aWNrRm9ybWF0KChkLCBpbmRleCkgPT5cbiAgICAgICAgICAgICAgICByZXR1cm4gQGdyYXBoRGF0YS5kYXRhW2luZGV4XS5sYWJlbC50b1VwcGVyQ2FzZSgpXG4gICAgICAgICAgICApXG4gICAgICAgICAgICAub3JpZW50KCdib3R0b20nKVxuXG5cblxuICAgICAgICBncnBkR3JhcGhEYXRhID0gQGdyYXBoRGF0YS5sYWJlbHMubWFwKChuKSA9PlxuICAgICAgICAgICAgQGdyYXBoRGF0YS5kYXRhLm1hcCAoZCwgaSkgLT5cbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHg6IGlcbiAgICAgICAgICAgICAgICAgICAgeTogZFtuXVxuICAgICAgICAgICAgICAgICAgICB5MDogMFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgKVxuXG4gICAgICAgIGQzLmxheW91dC5zdGFjaygpIGdycGRHcmFwaERhdGFcblxuICAgICAgICAjU2V0dGluZyBEb21haW5cbiAgICAgICAgYXV0b0RvbWFpbkNhbGMgPSAoYXhpcyk9PlxuICAgICAgICAgICAgaXNTdHJpbmcgPSBmYWxzZVxuICAgICAgICAgICAgaWYgdHlwZW9mIEBncmFwaERhdGEuZGF0YVswXVtheGlzXSBpcyBcInN0cmluZ1wiXG4gICAgICAgICAgICAgICAgaXNTdHJpbmcgPSB0cnVlXG5cbiAgICAgICAgICAgIGNhbGxiYWNrID0gKGQsaW5kZXgpIC0+XG4gICAgICAgICAgICAgICAgaWYgaXNTdHJpbmdcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGluZGV4XG4gICAgICAgICAgICAgICAgc3VtID0gMFxuICAgICAgICAgICAgICAgIGZvciBrLHYgb2YgZFxuICAgICAgICAgICAgICAgICAgICBpZiBrIGlzICdsYWJlbCdcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlXG4gICAgICAgICAgICAgICAgICAgIHN1bSArPSB2XG4gICAgICAgICAgICAgICAgcmV0dXJuICBzdW1cblxuICAgICAgICAgICAgI3RoaXMgdXNlcyBpbmRleFxuICAgICAgICAgICAgcmV0dXJuIFswLGQzLm1heChAZ3JhcGhEYXRhLmRhdGEsY2FsbGJhY2spKjEuMV1cblxuICAgICAgICB4RG9tYWluID0gWzAsQGdyYXBoRGF0YS5kYXRhLmxlbmd0aC0xXVxuICAgICAgICB5RG9tYWluID0gYXV0b0RvbWFpbkNhbGMoJ3knKVxuXG4gICAgICAgIHhTY2FsZS5kb21haW4oeERvbWFpbilcbiAgICAgICAgeVNjYWxlLmRvbWFpbih5RG9tYWluKVxuXG4gICAgICAgIEBncmFwaEdycC5hcHBlbmQoJ2cnKS5hdHRyKCdjbGFzcycsICd4YXhpcycpLmF0dHIoJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoMCwnICsgMCArICcpJykuY2FsbCB4QmFyXG4gICAgICAgIEBncmFwaEdycC5hcHBlbmQoJ2cnKS5hdHRyKCdjbGFzcycsICd5YXhpcycpLmNhbGwoeUF4aXMpXG5cblxuICAgICAgICBpZiBAcGhhc2VDb3VudCBpcyAwXG4gICAgICAgICAgICBAcGhhc2VDb3VudCA9IDFcblxuICAgICAgICAgICAgeWF4aXNUZXh0V2lkdGggPSBbXVxuXG4gICAgICAgICAgICBAZ3JhcGhHcnAuc2VsZWN0QWxsKCdnLnlheGlzJykuc2VsZWN0QWxsKCd0ZXh0JylcbiAgICAgICAgICAgICAgICAuZWFjaCgtPlxuICAgICAgICAgICAgICAgICAgICBzZWxmID0gZDMuc2VsZWN0KHRoaXMpXG4gICAgICAgICAgICAgICAgICAgIHRleHRMZW5ndGggPSBzZWxmLm5vZGUoKS5nZXRDb21wdXRlZFRleHRMZW5ndGgoKVxuICAgICAgICAgICAgICAgICAgICB5YXhpc1RleHRXaWR0aC5wdXNoIHRleHRMZW5ndGhcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgICAgICAgICAgKVxuXG4gICAgICAgICAgICB0ZXh0T2Zmc2V0Q29ycmVjdGlvbiA9IGQzLm1heCh5YXhpc1RleHRXaWR0aClcbiAgICAgICAgICAgIEBtYXJnaW4ubGVmdCA9ICBAbWFyZ2luT3JpZ2luYWwubGVmdCArIHRleHRPZmZzZXRDb3JyZWN0aW9uXG4gICAgICAgICAgICAjIEBtYXJnaW4ucmlnaHQgPSAgQG1hcmdpbk9yaWdpbmFsLnJpZ2h0ICsgdGV4dE9mZnNldENvcnJlY3Rpb25cbiAgICAgICAgICAgIEB3aWR0aCA9IEB3aWR0aE9yaWdpbmFsIC0gdGV4dE9mZnNldENvcnJlY3Rpb24vMi4wXG5cbiAgICAgICAgICAgIEByZXNldERpbWVuc2lvbigpXG5cbiAgICAgICAgICAgIEByZWRyYXcoKVxuICAgICAgICAgICAgcmV0dXJuXG5cbiAgICAgICAgQHBoYXNlQ291bnQgPSAwXG5cbiAgICAgICAgYXJlYSA9IGQzLnN2Zy5hcmVhKCkueCgoZCkgLT5cbiAgICAgICAgICAgIHhTY2FsZSBkLnhcbiAgICAgICAgKS55MCgoZCkgLT5cbiAgICAgICAgICAgIHlTY2FsZSBkLnkwXG4gICAgICAgICkueTEoKGQpIC0+XG4gICAgICAgICAgICB5U2NhbGUgZC55ICsgZC55MFxuICAgICAgICApXG5cblxuICAgICAgICBhZ2VHcm91cCA9IEBncmFwaEdycC5zZWxlY3RBbGwoJy52YWxncm91cCcpLmRhdGEoZ3JwZEdyYXBoRGF0YSkuZW50ZXIoKS5hcHBlbmQoJ2cnKS5hdHRyKCdjbGFzcycsICd2YWxncm91cCcpLnN0eWxlKCdmaWxsJywgKGQsIGkpIC0+XG4gICAgICAgICAgICBjb2xvclNjYWxlIGlcbiAgICAgICAgKS5hdHRyKCdjbGFzcycsIChkLCBpKSAtPlxuICAgICAgICAgICAgaG92ZXJMYWJlbCBpXG4gICAgICAgIClcblxuICAgICAgICBhZ2VHcm91cC5hcHBlbmQoJ3BhdGgnKS5hdHRyICdkJywgKGQpIC0+XG4gICAgICAgICAgICBhcmVhIGRcblxuXG4gICAgICAgIHhBeGlzVGlja3MgPSBAc3ZnRWxlLnNlbGVjdEFsbCgnLnhheGlzIC50aWNrIGxpbmUnKVxuICAgICAgICBbZmlyc3RUaWNrLCAuLi4sIGxhc3RUaWNrXSAgPSB4QXhpc1RpY2tzWzBdXG4gICAgICAgIGQzLnNlbGVjdChmaXJzdFRpY2spLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoMSwwKVwiKVxuICAgICAgICBkMy5zZWxlY3QobGFzdFRpY2spLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoLTEsMClcIilcbiJdfQ==