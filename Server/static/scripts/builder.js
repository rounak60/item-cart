(function() {
  app.controller('Builder', [
    "$scope", "$timeout", function($scope, $timeout) {
      return $scope.builderWidgets = builderWidgets;
    }
  ]);

  app.directive("mrBuilderEditor", [
    "$compile", "$timeout", "Upload", function($compile, $timeout, Upload) {
      return {
        scope: {
          widget: ' =mrWidgetData',
          closeEditor: '&mrClose'
        },
        restrict: 'AE',
        templateUrl: 'partials/builderform.html',
        link: function(scope, $ele, attrs, ctlr) {
          var $builderBox, $dash, $editor, $widget;
          $dash = $('.dash');
          $builderBox = $('.builder-box');
          $editor = $ele.find('.builder-editor');
          $widget = $ele.closest('mr-widget');
          $ele.find('.builder-close').on('click', function() {
            $builderBox.css({
              'display': 'block'
            });
            $builderBox.velocity({
              opacity: 1
            }, {
              easing: 'ease-in-out',
              duration: 200
            });
            $editor.velocity({
              scale: [0.6, 1.0],
              opacity: .0
            }, {
              easing: 'ease-in-out',
              duration: 300,
              complete: function() {
                $ele.remove();
                $widget.removeClass('is-active');
                return $timeout(function() {
                  return $widget.removeClass('is-active-animate');
                }, 400);
              }
            });
            return $widget.addClass('is-active').addClass('is-active-animate');
          });
          $editor.css({
            'opacity': 0
          });
          $ele.addClass('builder-editor-wrp');
          $editor.addClass('dash');
          $timeout(function() {
            $ele.insertAfter($dash);
            return $timeout(function() {
              $builderBox.velocity({
                opacity: 0
              }, {
                easing: 'ease-in-out',
                duration: 300,
                complete: function() {
                  return $builderBox.css({
                    'display': 'none'
                  });
                }
              });
              return $editor.velocity({
                scale: [1.0, 0.6],
                opacity: 1.0
              }, {
                easing: 'ease-in-out',
                duration: 300
              });
            }, 30);
          }, 0);
        },
        controller: function($scope) {
          var entry, i, lastGraphName, len;
          $scope.builderWidgets = [];
          $scope.builderWidgetsNames = [];
          $scope.widgetData = $scope.widget.data;
          $scope.editedData = angular.copy($scope.widgetData);
          lastGraphName = '';
          $scope.gridBackup = {};
          for (i = 0, len = builderWidgets.length; i < len; i++) {
            entry = builderWidgets[i];
            if (entry.hasSupport($scope.widget.widgetType) === false) {
              continue;
            }
            $scope.builderWidgetsNames.push(entry.name);
            $scope.builderWidgets.push(entry);
            if (entry.name === $scope.editedData.graphName) {
              lastGraphName = entry.name;
            }
          }
          $scope.$watch('editedData.graphName', function(curGraphName) {
            var cached, gridSupportor, inputData, j, len1, newGrid, ref, results;
            if (curGraphName != null) {
              ref = $scope.builderWidgets;
              results = [];
              for (j = 0, len1 = ref.length; j < len1; j++) {
                entry = ref[j];
                if (entry.name === curGraphName) {
                  cached = $scope.gridBackup[curGraphName];
                  if (cached != null) {
                    newGrid = cached;
                  } else {
                    gridSupportor = entry.getGrid($scope.widget.widgetType);
                    if (entry.name === $scope.widgetData.graphName) {
                      inputData = $scope.widgetData.graphData;
                    } else {
                      inputData = angular.copy(gridSupportor.data);
                    }
                    newGrid = new WidgetBuilderDataGenerator(gridSupportor, inputData);
                  }
                  $scope.gridBackup[lastGraphName] = $scope.grid;
                  $scope.grid = newGrid;
                  results.push(lastGraphName = curGraphName);
                } else {
                  results.push(void 0);
                }
              }
              return results;
            }
          });
          return $scope.close = function(isSave) {
            var editedDataFinal;
            editedDataFinal = void 0;
            if (isSave) {
              editedDataFinal = angular.copy($scope.editedData);
              editedDataFinal.graphData = $scope.grid.output();
              $scope.widgetData.graphData = void 0;
              $timeout(function() {
                return angular.merge($scope.widgetData, editedDataFinal);
              });
            }
            $timeout(function() {
              return $scope.closeEditor({
                isSave: isSave,
                data: editedDataFinal
              });
            });
          };
        }
      };
    }
  ]);

}).call(this);

//# sourceMappingURL=data:application/json;base64,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L3NvdXJjZS8iLCJzb3VyY2VzQ29udGVudCI6WyJcbmFwcC5jb250cm9sbGVyICdCdWlsZGVyJywgW1wiJHNjb3BlXCIsXCIkdGltZW91dFwiLCAoJHNjb3BlLCR0aW1lb3V0KSAtPlxuICAgICRzY29wZS5idWlsZGVyV2lkZ2V0cyA9IGJ1aWxkZXJXaWRnZXRzXG5dXG5cblxuXG5hcHAuZGlyZWN0aXZlIFwibXJCdWlsZGVyRWRpdG9yXCIsIFsgXCIkY29tcGlsZVwiICwgXCIkdGltZW91dFwiICwgXCJVcGxvYWRcIiwgKCAkY29tcGlsZSAsICR0aW1lb3V0LCBVcGxvYWQpIC0+XG5cblxuICAgIHJldHVybiAoXG5cbiAgICAgICAgc2NvcGU6XG4gICAgICAgICAgICB3aWRnZXQgIDogJyA9bXJXaWRnZXREYXRhJ1xuICAgICAgICAgICAgY2xvc2VFZGl0b3IgOiAnJm1yQ2xvc2UnXG5cbiAgICAgICAgcmVzdHJpY3Q6J0FFJ1xuXG4gICAgICAgIHRlbXBsYXRlVXJsIDogJ3BhcnRpYWxzL2J1aWxkZXJmb3JtLmh0bWwnXG5cblxuICAgICAgICBsaW5rIDogKHNjb3BlLCAkZWxlLCBhdHRycywgY3RscikgLT5cblxuICAgICAgICAgICAgJGRhc2ggPSAkKCcuZGFzaCcpXG4gICAgICAgICAgICAkYnVpbGRlckJveCA9ICQoJy5idWlsZGVyLWJveCcpXG4gICAgICAgICAgICAkZWRpdG9yID0gJGVsZS5maW5kKCcuYnVpbGRlci1lZGl0b3InKVxuXG4gICAgICAgICAgICAkd2lkZ2V0ID0gJGVsZS5jbG9zZXN0KCdtci13aWRnZXQnKVxuXG4gICAgICAgICAgICAjb24gY2xpY2sgY2xvc2UsIGNsb3NlIGFuaW1hdGlvblxuICAgICAgICAgICAgJGVsZS5maW5kKCcuYnVpbGRlci1jbG9zZScpLm9uICdjbGljaycsIC0+XG4gICAgICAgICAgICAgICAgJGJ1aWxkZXJCb3guY3NzICdkaXNwbGF5JzonYmxvY2snXG4gICAgICAgICAgICAgICAgJGJ1aWxkZXJCb3gudmVsb2NpdHkoXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6MVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVhc2luZzonZWFzZS1pbi1vdXQnXG4gICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogMjAwXG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAkZWRpdG9yLnZlbG9jaXR5KFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY2FsZTogWyAwLjYsMS4wXVxuICAgICAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTouMFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVhc2luZzonZWFzZS1pbi1vdXQnXG4gICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogMzAwXG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZTotPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRlbGUucmVtb3ZlKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkd2lkZ2V0LnJlbW92ZUNsYXNzKCdpcy1hY3RpdmUnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aW1lb3V0IC0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR3aWRnZXQucmVtb3ZlQ2xhc3MgJ2lzLWFjdGl2ZS1hbmltYXRlJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICw0MDBcblxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICApXG5cbiAgICAgICAgICAgICAgICAkd2lkZ2V0LmFkZENsYXNzKCdpcy1hY3RpdmUnKS5hZGRDbGFzcygnaXMtYWN0aXZlLWFuaW1hdGUnKVxuXG5cbiAgICAgICAgICAgICRlZGl0b3IuY3NzICdvcGFjaXR5JzowXG4gICAgICAgICAgICAkZWxlLmFkZENsYXNzICdidWlsZGVyLWVkaXRvci13cnAnXG4gICAgICAgICAgICAkZWRpdG9yLmFkZENsYXNzICdkYXNoJ1xuXG4gICAgICAgICAgICAkdGltZW91dCAtPlxuICAgICAgICAgICAgICAgICRlbGUuaW5zZXJ0QWZ0ZXIoJGRhc2gpXG5cbiAgICAgICAgICAgICAgICAkdGltZW91dCAtPlxuICAgICAgICAgICAgICAgICAgICAkYnVpbGRlckJveC52ZWxvY2l0eShcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OjBcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlYXNpbmc6J2Vhc2UtaW4tb3V0J1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiAzMDBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZTotPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYnVpbGRlckJveC5jc3MgJ2Rpc3BsYXknOidub25lJ1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIClcblxuXG4gICAgICAgICAgICAgICAgICAgICRlZGl0b3IudmVsb2NpdHkoXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGU6IFsgMS4wLDAuNl1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OjEuMFxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVhc2luZzonZWFzZS1pbi1vdXQnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IDMwMFxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAsMzBcbiAgICAgICAgICAgICwwXG5cblxuXG4gICAgICAgICAgICByZXR1cm5cblxuXG4gICAgICAgIGNvbnRyb2xsZXI6KCRzY29wZSktPlxuXG4gICAgICAgICAgICAkc2NvcGUuYnVpbGRlcldpZGdldHMgICAgICA9IFtdXG4gICAgICAgICAgICAkc2NvcGUuYnVpbGRlcldpZGdldHNOYW1lcyA9IFtdXG4gICAgICAgICAgICAkc2NvcGUud2lkZ2V0RGF0YSAgICAgICAgICA9ICRzY29wZS53aWRnZXQuZGF0YVxuICAgICAgICAgICAgJHNjb3BlLmVkaXRlZERhdGEgICAgICAgICAgPSBhbmd1bGFyLmNvcHkgJHNjb3BlLndpZGdldERhdGFcbiAgICAgICAgICAgIGxhc3RHcmFwaE5hbWUgICAgICAgICAgICAgID0gJydcbiAgICAgICAgICAgICRzY29wZS5ncmlkQmFja3VwICAgICAgICAgID0ge31cblxuICAgICAgICAgICAgIyBsb29wIGFsbCBidWlsZGVyIHdpZGdldHMsIGFuZCBnZXQgb25seSBzdXBwb3J0ZWQgd2lkZ2V0cy5cbiAgICAgICAgICAgIGZvciBlbnRyeSBpbiBidWlsZGVyV2lkZ2V0c1xuICAgICAgICAgICAgICAgIGlmIGVudHJ5Lmhhc1N1cHBvcnQoJHNjb3BlLndpZGdldC53aWRnZXRUeXBlKSBpcyBmYWxzZVxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZVxuXG4gICAgICAgICAgICAgICAgJHNjb3BlLmJ1aWxkZXJXaWRnZXRzTmFtZXMucHVzaCBlbnRyeS5uYW1lXG4gICAgICAgICAgICAgICAgJHNjb3BlLmJ1aWxkZXJXaWRnZXRzLnB1c2ggZW50cnlcblxuICAgICAgICAgICAgICAgIGlmIGVudHJ5Lm5hbWUgaXMgJHNjb3BlLmVkaXRlZERhdGEuZ3JhcGhOYW1lXG4gICAgICAgICAgICAgICAgICAgIGxhc3RHcmFwaE5hbWUgPSBlbnRyeS5uYW1lXG5cblxuXG5cbiAgICAgICAgICAgICRzY29wZS4kd2F0Y2ggJ2VkaXRlZERhdGEuZ3JhcGhOYW1lJywoY3VyR3JhcGhOYW1lKS0+XG4gICAgICAgICAgICAgICAgaWYgY3VyR3JhcGhOYW1lP1xuICAgICAgICAgICAgICAgICAgICBmb3IgZW50cnkgaW4gJHNjb3BlLmJ1aWxkZXJXaWRnZXRzXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiBlbnRyeS5uYW1lIGlzIGN1ckdyYXBoTmFtZVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FjaGVkID0gJHNjb3BlLmdyaWRCYWNrdXBbY3VyR3JhcGhOYW1lXVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgY2FjaGVkP1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdHcmlkID0gY2FjaGVkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmlkU3VwcG9ydG9yID0gZW50cnkuZ2V0R3JpZCgkc2NvcGUud2lkZ2V0LndpZGdldFR5cGUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGVudHJ5Lm5hbWUgaXMgJHNjb3BlLndpZGdldERhdGEuZ3JhcGhOYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnB1dERhdGEgPSAkc2NvcGUud2lkZ2V0RGF0YS5ncmFwaERhdGFcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXREYXRhID0gYW5ndWxhci5jb3B5KGdyaWRTdXBwb3J0b3IuZGF0YSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3R3JpZCA9IG5ldyBXaWRnZXRCdWlsZGVyRGF0YUdlbmVyYXRvcihncmlkU3VwcG9ydG9yLGlucHV0RGF0YSlcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5ncmlkQmFja3VwW2xhc3RHcmFwaE5hbWVdID0gJHNjb3BlLmdyaWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZ3JpZCA9IG5ld0dyaWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0R3JhcGhOYW1lID0gY3VyR3JhcGhOYW1lXG5cbiAgICAgICAgICAgICMgb24gY2xvc2UgcmV2ZXJ0IGRhdGEgYmFja1xuICAgICAgICAgICAgJHNjb3BlLmNsb3NlID0gKGlzU2F2ZSktPlxuICAgICAgICAgICAgICAgIGVkaXRlZERhdGFGaW5hbCA9IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgIGlmIGlzU2F2ZVxuICAgICAgICAgICAgICAgICAgICBlZGl0ZWREYXRhRmluYWwgPSBhbmd1bGFyLmNvcHkoJHNjb3BlLmVkaXRlZERhdGEpXG4gICAgICAgICAgICAgICAgICAgIGVkaXRlZERhdGFGaW5hbC5ncmFwaERhdGEgPSAkc2NvcGUuZ3JpZC5vdXRwdXQoKVxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUud2lkZ2V0RGF0YS5ncmFwaERhdGEgPSB1bmRlZmluZWRcblxuICAgICAgICAgICAgICAgICAgICAkdGltZW91dCAtPlxuICAgICAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5tZXJnZSgkc2NvcGUud2lkZ2V0RGF0YSxlZGl0ZWREYXRhRmluYWwpXG5cblxuICAgICAgICAgICAgICAgICR0aW1lb3V0IC0+XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5jbG9zZUVkaXRvcih7aXNTYXZlOmlzU2F2ZSxkYXRhOmVkaXRlZERhdGFGaW5hbH0pXG4gICAgICAgICAgICAgICAgcmV0dXJuXG5cblxuXG5cbiAgICApXG5cbl1cbiJdfQ==