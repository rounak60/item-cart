(function() {
  var addConstant;

  window.WidgetBuilderFormConstants = [];

  addConstant = function(key, value) {
    return WidgetBuilderFormConstants[key] = value;
  };

  addConstant('LABEL_FIELD', {
    type: "text",
    name: "label"
  });

  addConstant('CUSTOM_FIELD', {
    type: "number",
    name: "custom"
  });

  addConstant('SIMPLE_FORM', [
    WidgetBuilderFormConstants.LABEL_FIELD, {
      type: "number",
      name: "d"
    }, {
      type: "text",
      name: "subtext",
      optional: true
    }
  ]);

  window.WidgetBuilder = (function() {
    WidgetBuilder.prototype.graphIcon = void 0;

    WidgetBuilder.prototype.type = "1";

    WidgetBuilder.prototype.supports = void 0;

    function WidgetBuilder(name, type) {
      this.name = name;
      this.type = type || this.type;
      this.supports = {};
    }

    WidgetBuilder.prototype.addSupport = function(gridType, formData) {
      var gridSupport;
      gridSupport = new WidgetBuilderGridSupport(gridType, formData);
      gridSupport.type = this.type;
      gridSupport.className = this.className;
      gridSupport.parent = this;
      this.supports[gridType] = gridSupport;
      return gridSupport;
    };

    WidgetBuilder.prototype.addData = function(forGridType, data) {
      var targetGridEntry;
      targetGridEntry = this.hasSupport(forGridType);
      if (targetGridEntry) {
        return targetGridEntry.data = data;
      } else {
        throw new Error("Grid entry for mentioned grid type not available");
      }
    };

    WidgetBuilder.prototype.hasSupport = function(forGridType) {
      var targetGridEntry;
      targetGridEntry = this.supports[forGridType];
      if (targetGridEntry != null) {
        return targetGridEntry;
      }
      return false;
    };

    WidgetBuilder.prototype.getGrid = function(forGridType) {
      var targetGridEntry;
      targetGridEntry = this.hasSupport(forGridType);
      if (!targetGridEntry) {
        throw new Error("Grid entry for mentioned grid type not available");
      }
      return angular.copy(targetGridEntry);
    };

    return WidgetBuilder;

  })();

  window.WidgetBuilderGridSupport = (function() {
    WidgetBuilderGridSupport.prototype.rows = [1, 1];

    WidgetBuilderGridSupport.prototype.columns = 2;

    WidgetBuilderGridSupport.prototype.data = {};

    function WidgetBuilderGridSupport(gridType1, formData1) {
      this.gridType = gridType1;
      this.formData = formData1;
      this.setRowCount([1, 1]);
      this.setColumnCount(2);
    }

    WidgetBuilderGridSupport.prototype.setColumnCount = function(columnCount) {
      var minColNo;
      this.columns = columnCount;
      this.isColumnsFixed = typeof this.columns === "number" ? true : false;
      this.minColNo = minColNo = this.isColumnsFixed ? this.columns : this.columns[0];
      this.maxColNo = this.isColumnsFixed ? this.columns : this.columns[1];
      return this;
    };

    WidgetBuilderGridSupport.prototype.setRowCount = function(rowCount) {
      var minRowNo;
      this.rows = rowCount;
      this.isRowsFixed = typeof this.rows === "number" ? true : false;
      this.minRowNo = minRowNo = this.isRowsFixed ? this.rows : this.rows[0];
      this.maxRowNo = this.isRowsFixed ? this.rows : this.rows[1];
      return this;
    };

    WidgetBuilderGridSupport.prototype.setData = function(data) {
      this.data = angular.copy(data);
      return this;
    };

    return WidgetBuilderGridSupport;

  })();

  window.WidgetBuilderDataGenerator = (function() {
    function WidgetBuilderDataGenerator(gridSupportor, graphData) {
      var field, firstFormEntry, formData, i, j, k, l, label, labelData, labels, len, len1, len2, len3, m, minColNo, minRowNo, n, o, ref, ref1, ref2, ref3, ref4, ref5, ref6, row, rowData;
      this.gridSupportor = gridSupportor;
      this.gs = this.gridSupportor;
      this.graphData = angular.copy(graphData);
      formData = this.gridSupportor.formData;
      labelData = this.labelData = [];
      if (typeof this.graphData !== 'undefined') {
        this.rowData = rowData = ((ref = this.graphData) != null ? ref.data : void 0) || [];
      }
      labels = (ref1 = this.graphData) != null ? ref1.labels : void 0;
      minColNo = this.gridSupportor.minColNo;
      minRowNo = this.gridSupportor.minRowNo;
      if (labels == null) {
        labels = [];
        for (j = 0, len = formData.length; j < len; j++) {
          field = formData[j];
          if (!((ref2 = field.name) === 'label' || ref2 === 'custom')) {
            labels.push(field.name);
          }
        }
      }
      firstFormEntry = formData[0];
      if ((firstFormEntry != null) && firstFormEntry.name === 'label') {
        labels.unshift('label');
      }
      if (labels != null) {
        for (k = 0, len1 = labels.length; k < len1; k++) {
          label = labels[k];
          this.addColumn(label);
        }
      }
      if (minColNo > labelData.length) {
        for (i = l = ref3 = labelData.length, ref4 = minColNo; ref3 <= ref4 ? l < ref4 : l > ref4; i = ref3 <= ref4 ? ++l : --l) {
          this.addColumn('');
        }
      }
      for (m = 0, len2 = rowData.length; m < len2; m++) {
        row = rowData[m];
        for (n = 0, len3 = labelData.length; n < len3; n++) {
          label = labelData[n];
          if (label.name !== '') {
            row[label.id] = row[label.name];
            delete row[label.name];
          }
        }
      }
      if (minRowNo > rowData.length) {
        for (i = o = ref5 = rowData.length, ref6 = minRowNo; ref5 <= ref6 ? o < ref6 : o > ref6; i = ref5 <= ref6 ? ++o : --o) {
          this.addRow();
        }
      }
      return;
    }

    WidgetBuilderDataGenerator.prototype.addRow = function() {
      return this.rowData.push({});
    };

    WidgetBuilderDataGenerator.prototype.addColumn = function(label, index) {
      var formData, formDataEntry, formDataIndex, labelItem;
      labelItem = {
        "name": label,
        'id': generateRandom()
      };
      labelItem.placeholder = (labelItem.name === 'd' ? "Value" : labelItem.name);
      if (index != null) {
        arr.splice(index, 0, labelItem);
      } else {
        this.labelData.push(labelItem);
      }
      formData = this.gridSupportor.formData;
      formDataIndex = Math.min(this.labelData.length, formData.length) - 1;
      formDataEntry = formData[formDataIndex];
      labelItem.form = angular.copy(formDataEntry);
      return true;
    };

    WidgetBuilderDataGenerator.prototype.isAllowAddRow = function() {
      if (this.gridSupportor.isRowsFixed) {
        return false;
      }
      return this.rowData.length < this.gridSupportor.rows[1];
    };

    WidgetBuilderDataGenerator.prototype.deleteColumn = function(entry) {
      var index;
      index = this.labelData.indexOf(entry);
      return this.labelData.splice(index, 1);
    };

    WidgetBuilderDataGenerator.prototype.deleteRow = function(entry) {
      var index;
      index = this.rowData.indexOf(entry);
      return this.rowData.splice(index, 1);
    };

    WidgetBuilderDataGenerator.prototype.isAllowAddColumn = function() {
      if (this.gridSupportor.isColumnsFixed) {
        return false;
      }
      return this.labelData.length < this.gridSupportor.columns[1];
    };

    WidgetBuilderDataGenerator.prototype.isAllowDeleteRow = function() {
      if (this.gridSupportor.isRowsFixed) {
        return false;
      }
      return this.rowData.length > this.gridSupportor.rows[0];
    };

    WidgetBuilderDataGenerator.prototype.isAllowDeleteColumn = function() {
      if (this.gridSupportor.isColumnsFixed) {
        return false;
      }
      return this.labelData.length > this.gridSupportor.columns[0];
    };

    WidgetBuilderDataGenerator.prototype.getSrc = function(column) {
      if (typeof column.form.src === "string") {
        return this.gs.data[column.form.src];
      }
      return column.form.src;
    };

    WidgetBuilderDataGenerator.prototype.setModel = function(column, output) {
      var entry, j, len, srcList;
      srcList = this.getSrc(column);
      if (srcList == null) {
        throw new Error("Src is undefined for column", column);
      }
      if (output != null) {
        for (j = 0, len = srcList.length; j < len; j++) {
          entry = srcList[j];
          if (entry.name === output.name) {
            return entry;
          }
        }
      }
      return column.form["default"];
    };

    WidgetBuilderDataGenerator.prototype.output = function() {
      var entry, i, isBlankRow, j, k, l, labelEntry, len, len1, len2, len3, m, newRow, newVal, output, ref, ref1, ref2, row, rowData, rowIndex, src;
      output = {
        labels: [],
        data: []
      };
      rowData = angular.copy(this.rowData);
      ref = this.labelData;
      for (i = j = 0, len = ref.length; j < len; i = ++j) {
        entry = ref[i];
        if (entry.name.trim() === '') {
          entry.name = "Region " + i;
        }
      }
      for (rowIndex = k = 0, len1 = rowData.length; k < len1; rowIndex = ++k) {
        row = rowData[rowIndex];
        newRow = {};
        isBlankRow = true;
        ref1 = this.labelData;
        for (l = 0, len2 = ref1.length; l < len2; l++) {
          labelEntry = ref1[l];
          newVal = row[labelEntry.id];
          if (newVal == null) {
            newVal = (function() {
              switch (labelEntry.form.type) {
                case "number":
                  return 0;
                case "text":
                case "textarea":
                  return '';
                case "file":
                  return void 0;
                case "select":
                  src = this.getSrc(labelEntry);
                  console.log(src, src[src.length - 1]);
                  return src[src.length - 1];
              }
            }).call(this);
          } else {
            isBlankRow = false;
          }
          newRow[labelEntry.name] = newVal;
        }
        if (!isBlankRow) {
          output.data.push(newRow);
        }
      }
      ref2 = this.labelData;
      for (m = 0, len3 = ref2.length; m < len3; m++) {
        labelEntry = ref2[m];
        if (labelEntry.name === 'label') {
          continue;
        }
        output.labels.push(labelEntry.name);
      }
      console.log(output);
      return output;
    };

    return WidgetBuilderDataGenerator;

  })();

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJ1aWxkZXIvd2lkZ2V0YnVpbGRlci5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0E7QUFBQSxNQUFBLFdBQUE7O0FBQUEsRUFBQSxNQUFNLENBQUMsMEJBQVAsR0FBb0MsRUFBcEMsQ0FBQTs7QUFBQSxFQUNBLFdBQUEsR0FBYyxTQUFDLEdBQUQsRUFBSyxLQUFMLEdBQUE7V0FDViwwQkFBMkIsQ0FBQSxHQUFBLENBQTNCLEdBQWtDLE1BRHhCO0VBQUEsQ0FEZCxDQUFBOztBQUFBLEVBSUEsV0FBQSxDQUFZLGFBQVosRUFBMEI7QUFBQSxJQUNkLElBQUEsRUFBSyxNQURTO0FBQUEsSUFFZCxJQUFBLEVBQU0sT0FGUTtHQUExQixDQUpBLENBQUE7O0FBQUEsRUFXQSxXQUFBLENBQVksY0FBWixFQUEyQjtBQUFBLElBQ2YsSUFBQSxFQUFLLFFBRFU7QUFBQSxJQUVmLElBQUEsRUFBTSxRQUZTO0dBQTNCLENBWEEsQ0FBQTs7QUFBQSxFQWlCQSxXQUFBLENBQVksYUFBWixFQUEwQjtJQUNsQiwwQkFBMEIsQ0FBQyxXQURULEVBRWxCO0FBQUEsTUFDSSxJQUFBLEVBQUssUUFEVDtBQUFBLE1BRUksSUFBQSxFQUFNLEdBRlY7S0FGa0IsRUFPbEI7QUFBQSxNQUNJLElBQUEsRUFBSyxNQURUO0FBQUEsTUFFSSxJQUFBLEVBQU0sU0FGVjtBQUFBLE1BR0ksUUFBQSxFQUFTLElBSGI7S0FQa0I7R0FBMUIsQ0FqQkEsQ0FBQTs7QUFBQSxFQXVDTSxNQUFNLENBQUM7QUFFVCw0QkFBQSxTQUFBLEdBQVksTUFBWixDQUFBOztBQUFBLDRCQUVBLElBQUEsR0FBTyxHQUZQLENBQUE7O0FBQUEsNEJBSUEsUUFBQSxHQUFTLE1BSlQsQ0FBQTs7QUFPYSxJQUFBLHVCQUFDLElBQUQsRUFBTyxJQUFQLEdBQUE7QUFDVCxNQURVLElBQUMsQ0FBQSxPQUFELElBQ1YsQ0FBQTtBQUFBLE1BQUEsSUFBQyxDQUFBLElBQUQsR0FBUSxJQUFBLElBQVEsSUFBQyxDQUFB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LENBSEEsQ0FGSjtBQUFBLE9BekNBO0FBQUEsTUFnREEsT0FBTyxDQUFDLEdBQVIsQ0FBWSxNQUFaLENBaERBLENBQUE7QUFrREEsYUFBTyxNQUFQLENBbkRJO0lBQUEsQ0FsSVIsQ0FBQTs7c0NBQUE7O01BOUhKLENBQUE7QUFBQSIsImZpbGUiOiJidWlsZGVyL3dpZGdldGJ1aWxkZXIuanMiLCJzb3VyY2VSb290IjoiL3NvdXJjZS8iLCJzb3VyY2VzQ29udGVudCI6WyIjIEJ1aWxkZXIgd2lkZ2V0IGhlbHBlclxud2luZG93LldpZGdldEJ1aWxkZXJGb3JtQ29uc3RhbnRzID0gW11cbmFkZENvbnN0YW50ID0gKGtleSx2YWx1ZSkgLT5cbiAgICBXaWRnZXRCdWlsZGVyRm9ybUNvbnN0YW50c1trZXldID0gdmFsdWVcblxuYWRkQ29uc3RhbnQoJ0xBQkVMX0ZJRUxEJyx7XG4gICAgICAgICAgICB0eXBlOlwidGV4dFwiXG4gICAgICAgICAgICBuYW1lOiBcImxhYmVsXCJcblxuICAgICAgICB9XG4pXG5cbmFkZENvbnN0YW50KCdDVVNUT01fRklFTEQnLHtcbiAgICAgICAgICAgIHR5cGU6XCJudW1iZXJcIlxuICAgICAgICAgICAgbmFtZTogXCJjdXN0b21cIlxuXG4gICAgICAgIH1cbilcbmFkZENvbnN0YW50KCdTSU1QTEVfRk9STScsW1xuICAgICAgICBXaWRnZXRCdWlsZGVyRm9ybUNvbnN0YW50cy5MQUJFTF9GSUVMRFxuICAgICAgICB7XG4gICAgICAgICAgICB0eXBlOlwibnVtYmVyXCJcbiAgICAgICAgICAgIG5hbWU6IFwiZFwiXG5cbiAgICAgICAgfVxuICAgICAgICB7XG4gICAgICAgICAgICB0eXBlOlwidGV4dFwiXG4gICAgICAgICAgICBuYW1lOiBcInN1YnRleHRcIlxuICAgICAgICAgICAgb3B0aW9uYWw6dHJ1ZVxuXG4gICAgICAgIH1cblxuXG4gICAgXVxuKVxuXG5cblxuXG5cbmNsYXNzIHdpbmRvdy5XaWRnZXRCdWlsZGVyXG5cbiAgICBncmFwaEljb24gOiB1bmRlZmluZWRcblxuICAgIHR5cGUgOiBcIjFcIlxuXG4gICAgc3VwcG9ydHM6dW5kZWZpbmVkXG5cblxuICAgIGNvbnN0cnVjdG9yOiAoQG5hbWUsdHlwZSkgLT5cbiAgICAgICAgQHR5cGUgPSB0eXBlIHx8IEB0eXBlXG4gICAgICAgIEBzdXBwb3J0cyA9IHt9XG5cblxuICAgIGFkZFN1cHBvcnQ6KGdyaWRUeXBlLGZvcm1EYXRhKS0+XG4gICAgICAgIGdyaWRTdXBwb3J0ICAgICAgICAgICA9IG5ldyBXaWRnZXRCdWlsZGVyR3JpZFN1cHBvcnQoZ3JpZFR5cGUsZm9ybURhdGEpXG4gICAgICAgIGdyaWRTdXBwb3J0LnR5cGUgICAgICA9IEB0eXBlXG4gICAgICAgIGdyaWRTdXBwb3J0LmNsYXNzTmFtZSA9IEBjbGFzc05hbWVcbiAgICAgICAgZ3JpZFN1cHBvcnQucGFyZW50ICAgID0gQFxuICAgICAgICBAc3VwcG9ydHNbZ3JpZFR5cGVdID0gZ3JpZFN1cHBvcnRcbiAgICAgICAgcmV0dXJuIGdyaWRTdXBwb3J0XG5cbiAgICBhZGREYXRhOihmb3JHcmlkVHlwZSxkYXRhKS0+XG4gICAgICAgIHRhcmdldEdyaWRFbnRyeSA9IEBoYXNTdXBwb3J0KGZvckdyaWRUeXBlKVxuICAgICAgICBpZiB0YXJnZXRHcmlkRW50cnlcbiAgICAgICAgICAgIHRhcmdldEdyaWRFbnRyeS5kYXRhID0gZGF0YVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJHcmlkIGVudHJ5IGZvciBtZW50aW9uZWQgZ3JpZCB0eXBlIG5vdCBhdmFpbGFibGVcIilcblxuICAgIGhhc1N1cHBvcnQgOiAoZm9yR3JpZFR5cGUpLT5cbiAgICAgICAgdGFyZ2V0R3JpZEVudHJ5ID0gQHN1cHBvcnRzW2ZvckdyaWRUeXBlXVxuICAgICAgICBpZiB0YXJnZXRHcmlkRW50cnk/XG4gICAgICAgICAgICByZXR1cm4gdGFyZ2V0R3JpZEVudHJ5XG4gICAgICAgIHJldHVybiBmYWxzZVxuXG4gICAgZ2V0R3JpZDogKGZvckdyaWRUeXBlKS0+XG4gICAgICAgIHRhcmdldEdyaWRFbnRyeSA9IEBoYXNTdXBwb3J0KGZvckdyaWRUeXBlKVxuICAgICAgICBpZiBub3QgdGFyZ2V0R3JpZEVudHJ5XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJHcmlkIGVudHJ5IGZvciBtZW50aW9uZWQgZ3JpZCB0eXBlIG5vdCBhdmFpbGFibGVcIilcblxuICAgICAgICByZXR1cm4gYW5ndWxhci5jb3B5KHRhcmdldEdyaWRFbnRyeSlcblxuXG5cbmNsYXNzIHdpbmRvdy5XaWRnZXRCdWlsZGVyR3JpZFN1cHBvcnRcblxuICAgIHJvd3MgICAgOiBbMSwxXSAjYXJyYXkgc2V0cyByYW5nZSxtZWFuaW5nIGxhYmVscyBhcmUgZWRpdGFibGVcblxuICAgIGNvbHVtbnMgOiAyICMgaW50ZWdlciBzZXRzIGZpeGVkIG51bWJlciB3aXRoIHVuZWRpdGFibGUgbGFiZWxzXG5cbiAgICBkYXRhIDoge31cblxuXG5cbiAgICBjb25zdHJ1Y3RvcjogKEBncmlkVHlwZSxAZm9ybURhdGEpIC0+XG4gICAgICAgIEBzZXRSb3dDb3VudChbMSwxXSlcbiAgICAgICAgQHNldENvbHVtbkNvdW50KDIpXG5cbiAgICBzZXRDb2x1bW5Db3VudDogKGNvbHVtbkNvdW50KS0+XG4gICAgICAgIEBjb2x1bW5zID0gY29sdW1uQ291bnRcblxuICAgICAgICAjIENoZWNrIGNvbHVtbnMgYW5kIHJvd3MgZmxleGlibGUoZHluYW1pYykgb3Igbm90XG4gICAgICAgIEBpc0NvbHVtbnNGaXhlZCA9IGlmIHR5cGVvZiBAY29sdW1ucyBpcyBcIm51bWJlclwiIHRoZW4gdHJ1ZSBlbHNlIGZhbHNlXG5cbiAgICAgICAgIyBjYWxjdWxhdGUgbWluIGFuZCBtYXggYWxsb3dlZCBjb2xzIGFuZCByb3dzXG4gICAgICAgIEBtaW5Db2xObyA9IG1pbkNvbE5vID0gaWYgQGlzQ29sdW1uc0ZpeGVkIHRoZW4gQGNvbHVtbnMgZWxzZSBAY29sdW1uc1swXVxuICAgICAgICBAbWF4Q29sTm8gPSBpZiBAaXNDb2x1bW5zRml4ZWQgdGhlbiBAY29sdW1ucyBlbHNlIEBjb2x1bW5zWzFdXG5cbiAgICAgICAgcmV0dXJuIEBcblxuICAgIHNldFJvd0NvdW50OiAocm93Q291bnQpLT5cbiAgICAgICAgQHJvd3MgPSByb3dDb3VudFxuXG4gICAgICAgIEBpc1Jvd3NGaXhlZCA9IGlmIHR5cGVvZiBAcm93cyBpcyBcIm51bWJlclwiIHRoZW4gdHJ1ZSBlbHNlIGZhbHNlXG4gICAgICAgIEBtaW5Sb3dObyA9IG1pblJvd05vID0gaWYgQGlzUm93c0ZpeGVkIHRoZW4gQHJvd3MgZWxzZSBAcm93c1swXVxuICAgICAgICBAbWF4Um93Tm8gPSBpZiBAaXNSb3dzRml4ZWQgdGhlbiBAcm93cyBlbHNlIEByb3dzWzFdXG5cbiAgICAgICAgcmV0dXJuIEBcblxuICAgIHNldERhdGEgOiAoZGF0YSktPlxuICAgICAgICBAZGF0YSA9IGFuZ3VsYXIuY29weShkYXRhKVxuICAgICAgICByZXR1cm4gQFxuXG5cblxuXG5jbGFzcyB3aW5kb3cuV2lkZ2V0QnVpbGRlckRhdGFHZW5lcmF0b3JcbiAgICBjb25zdHJ1Y3RvcjooQGdyaWRTdXBwb3J0b3IsZ3JhcGhEYXRhKS0+XG4gICAgICAgIEBncyAgICAgICAgID0gQGdyaWRTdXBwb3J0b3JcbiAgICAgICAgQGdyYXBoRGF0YSAgPSBhbmd1bGFyLmNvcHkoZ3JhcGhEYXRhKVxuICAgICAgICBmb3JtRGF0YSAgICA9IEBncmlkU3VwcG9ydG9yLmZvcm1EYXRhXG4gICAgICAgIGxhYmVsRGF0YSAgID0gQGxhYmVsRGF0YSA9IFtdXG4gICAgICAgIGlmIHR5cGVvZiBAZ3JhcGhEYXRhIGlzbnQgJ3VuZGVmaW5lZCdcbiAgICAgICAgICAgIEByb3dEYXRhID0gcm93RGF0YSA9IEBncmFwaERhdGE/LmRhdGEgfHwgW11cblxuICAgICAgICBsYWJlbHMgPSBAZ3JhcGhEYXRhPy5sYWJlbHNcblxuICAgICAgICBtaW5Db2xObyA9IEBncmlkU3VwcG9ydG9yLm1pbkNvbE5vXG4gICAgICAgIG1pblJvd05vID0gQGdyaWRTdXBwb3J0b3IubWluUm93Tm9cblxuICAgICAgICBpZiBub3QgbGFiZWxzP1xuICAgICAgICAgICAgbGFiZWxzID0gW11cbiAgICAgICAgICAgIGZvciBmaWVsZCBpbiBmb3JtRGF0YVxuICAgICAgICAgICAgICAgIGlmIG5vdCAoZmllbGQubmFtZSBpbiBbJ2xhYmVsJywnY3VzdG9tJ10pXG4gICAgICAgICAgICAgICAgICAgIGxhYmVscy5wdXNoIGZpZWxkLm5hbWVcblxuICAgICAgICAjIGlmIGZvcm1kYXRhIGhhcyBmaWVsZCB3aXRoICdsYWJlbCcgYXMgbmFtZSB0aGVuIHB1c2ggaXQgdG8gbGFiZWxzXG4gICAgICAgIGZpcnN0Rm9ybUVudHJ5ID0gZm9ybURhdGFbMF1cbiAgICAgICAgaWYgZmlyc3RGb3JtRW50cnk/IGFuZCBmaXJzdEZvcm1FbnRyeS5uYW1lICBpcyAnbGFiZWwnXG4gICAgICAgICAgICBsYWJlbHMudW5zaGlmdCAnbGFiZWwnXG5cbiAgICAgICAgIyBjYWxjdWxhdGUgY29sdW1uc1xuICAgICAgICBpZiBsYWJlbHM/XG4gICAgICAgICAgICBmb3IgbGFiZWwgaW4gbGFiZWxzXG4gICAgICAgICAgICAgICAgQGFkZENvbHVtbihsYWJlbClcblxuXG5cbiAgICAgICAgIyBmaWxsIGVtcHR5IHBsYWNlaG9sZGVycyB0byBmaWxsIG1pbiBjb2wgbm9cbiAgICAgICAgaWYgbWluQ29sTm8gPiBsYWJlbERhdGEubGVuZ3RoXG4gICAgICAgICAgICBmb3IgaSBpbiBbbGFiZWxEYXRhLmxlbmd0aC4uLm1pbkNvbE5vXVxuICAgICAgICAgICAgICAgIEBhZGRDb2x1bW4oJycpXG5cblxuICAgICAgICAjIHJlcGVhdCBzYW1lXG4gICAgICAgIGZvciByb3cgaW4gcm93RGF0YVxuICAgICAgICAgICAgZm9yIGxhYmVsIGluIGxhYmVsRGF0YVxuICAgICAgICAgICAgICAgIGlmIGxhYmVsLm5hbWUgaXNudCAnJ1xuICAgICAgICAgICAgICAgICAgICByb3dbbGFiZWwuaWRdID0gcm93W2xhYmVsLm5hbWVdXG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSByb3dbbGFiZWwubmFtZV1cblxuXG5cbiAgICAgICAgaWYgbWluUm93Tm8gPiByb3dEYXRhLmxlbmd0aFxuICAgICAgICAgICAgZm9yIGkgaW4gW3Jvd0RhdGEubGVuZ3RoLi4ubWluUm93Tm9dXG4gICAgICAgICAgICAgICAgQGFkZFJvdygpXG5cbiAgICAgICAgcmV0dXJuXG5cbiAgICBhZGRSb3cgOiAtPlxuICAgICAgICBAcm93RGF0YS5wdXNoIHt9XG5cbiAgICBhZGRDb2x1bW4gOiAobGFiZWwsaW5kZXgpLT5cblxuICAgICAgICBsYWJlbEl0ZW0gPSB7XCJuYW1lXCI6bGFiZWwsJ2lkJzpnZW5lcmF0ZVJhbmRvbSgpfVxuXG4gICAgICAgIGxhYmVsSXRlbS5wbGFjZWhvbGRlciA9ICggaWYgbGFiZWxJdGVtLm5hbWUgaXMgJ2QnIHRoZW4gXCJWYWx1ZVwiIGVsc2UgbGFiZWxJdGVtLm5hbWUgKVxuXG5cbiAgICAgICAgaWYgaW5kZXg/XG4gICAgICAgICAgICBhcnIuc3BsaWNlKGluZGV4LCAwLCBsYWJlbEl0ZW0pXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIEBsYWJlbERhdGEucHVzaCBsYWJlbEl0ZW1cblxuXG4gICAgICAgIGZvcm1EYXRhICAgICAgID0gQGdyaWRTdXBwb3J0b3IuZm9ybURhdGFcbiAgICAgICAgZm9ybURhdGFJbmRleCAgPSBNYXRoLm1pbihAbGFiZWxEYXRhLmxlbmd0aCxmb3JtRGF0YS5sZW5ndGgpLTFcbiAgICAgICAgZm9ybURhdGFFbnRyeSAgPSBmb3JtRGF0YVtmb3JtRGF0YUluZGV4XVxuICAgICAgICBsYWJlbEl0ZW0uZm9ybSA9IGFuZ3VsYXIuY29weShmb3JtRGF0YUVudHJ5KVxuXG4gICAgICAgIHJldHVybiB0cnVlXG5cblxuXG4gICAgaXNBbGxvd0FkZFJvdyA6IC0+XG4gICAgICAgIGlmIEBncmlkU3VwcG9ydG9yLmlzUm93c0ZpeGVkXG4gICAgICAgICAgICByZXR1cm4gZmFsc2VcblxuICAgICAgICByZXR1cm4gQHJvd0RhdGEubGVuZ3RoIDwgQGdyaWRTdXBwb3J0b3Iucm93c1sxXVxuXG4gICAgZGVsZXRlQ29sdW1uOihlbnRyeSktPlxuICAgICAgICBpbmRleCA9IEBsYWJlbERhdGEuaW5kZXhPZihlbnRyeSlcbiAgICAgICAgQGxhYmVsRGF0YS5zcGxpY2UoaW5kZXgsIDEpXG5cbiAgICBkZWxldGVSb3c6KGVudHJ5KS0+XG4gICAgICAgIGluZGV4ID0gQHJvd0RhdGEuaW5kZXhPZihlbnRyeSlcbiAgICAgICAgQHJvd0RhdGEuc3BsaWNlKGluZGV4LCAxKVxuXG5cbiAgICBpc0FsbG93QWRkQ29sdW1uIDogLT5cbiAgICAgICAgaWYgQGdyaWRTdXBwb3J0b3IuaXNDb2x1bW5zRml4ZWRcbiAgICAgICAgICAgIHJldHVybiBmYWxzZVxuXG4gICAgICAgIHJldHVybiBAbGFiZWxEYXRhLmxlbmd0aCA8IEBncmlkU3VwcG9ydG9yLmNvbHVtbnNbMV1cblxuICAgIGlzQWxsb3dEZWxldGVSb3cgOiAtPlxuICAgICAgICBpZiBAZ3JpZFN1cHBvcnRvci5pc1Jvd3NGaXhlZFxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlXG5cbiAgICAgICAgcmV0dXJuIEByb3dEYXRhLmxlbmd0aCA+IEBncmlkU3VwcG9ydG9yLnJvd3NbMF1cblxuICAgIGlzQWxsb3dEZWxldGVDb2x1bW4gOiAtPlxuICAgICAgICBpZiBAZ3JpZFN1cHBvcnRvci5pc0NvbHVtbnNGaXhlZFxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlXG5cbiAgICAgICAgcmV0dXJuIEBsYWJlbERhdGEubGVuZ3RoID4gQGdyaWRTdXBwb3J0b3IuY29sdW1uc1swXVxuXG4gICAgZ2V0U3JjOiAoY29sdW1uKS0+XG4gICAgICAgIGlmIHR5cGVvZiBjb2x1bW4uZm9ybS5zcmMgaXMgXCJzdHJpbmdcIlxuICAgICAgICAgICAgcmV0dXJuIEBncy5kYXRhW2NvbHVtbi5mb3JtLnNyY11cblxuICAgICAgICByZXR1cm4gY29sdW1uLmZvcm0uc3JjXG5cbiAgICBzZXRNb2RlbDooY29sdW1uLG91dHB1dCktPlxuICAgICAgICBzcmNMaXN0ID0gQGdldFNyYyhjb2x1bW4pXG5cbiAgICAgICAgaWYgbm90IHNyY0xpc3Q/XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTcmMgaXMgdW5kZWZpbmVkIGZvciBjb2x1bW5cIixjb2x1bW4pXG5cbiAgICAgICAgaWYgb3V0cHV0P1xuICAgICAgICAgICAgZm9yIGVudHJ5IGluIHNyY0xpc3RcbiAgICAgICAgICAgICAgICBpZiBlbnRyeS5uYW1lIGlzIG91dHB1dC5uYW1lXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlbnRyeVxuICAgICAgICByZXR1cm4gY29sdW1uLmZvcm0uZGVmYXVsdFxuXG5cblxuICAgIG91dHB1dDogLT5cbiAgICAgICAgb3V0cHV0ID0ge1xuICAgICAgICAgICAgbGFiZWxzOltdXG4gICAgICAgICAgICBkYXRhIDogW11cbiAgICAgICAgfVxuXG4gICAgICAgIHJvd0RhdGEgPSBhbmd1bGFyLmNvcHkoQHJvd0RhdGEpXG5cbiAgICAgICAgIyBpZiBsYWJlbCBpcyBlbXB0eSBzdHJpbmcgLCByZXBsYWNlIHdpdGggc2FtcGxlIHRpdGxlXG4gICAgICAgIGZvciBlbnRyeSxpIGluIEBsYWJlbERhdGFcbiAgICAgICAgICAgIGlmIGVudHJ5Lm5hbWUudHJpbSgpIGlzICcnXG4gICAgICAgICAgICAgICAgZW50cnkubmFtZSA9IFwiUmVnaW9uICN7aX1cIlxuXG4gICAgICAgICMgbG9vcCByb3dzIGFuZCBjaGFuZ2UgZnJvbSBsYWJlbC5pZCB0byBsYWJlbC5uYW1lIGFzIGtleXNcbiAgICAgICAgZm9yIHJvdyxyb3dJbmRleCBpbiByb3dEYXRhXG5cbiAgICAgICAgICAgIG5ld1JvdyA9IHt9XG4gICAgICAgICAgICBpc0JsYW5rUm93ID0gdHJ1ZVxuXG4gICAgICAgICAgICBmb3IgbGFiZWxFbnRyeSBpbiBAbGFiZWxEYXRhXG4gICAgICAgICAgICAgICAgbmV3VmFsID0gcm93W2xhYmVsRW50cnkuaWRdXG4gICAgICAgICAgICAgICAgaWYgbm90IG5ld1ZhbD9cbiAgICAgICAgICAgICAgICAgICAgbmV3VmFsID0gc3dpdGNoIGxhYmVsRW50cnkuZm9ybS50eXBlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoZW4gXCJudW1iZXJcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGVuIFwidGV4dFwiLFwidGV4dGFyZWFcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJydcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hlbiBcImZpbGVcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hlbiBcInNlbGVjdFwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcmMgPSBAZ2V0U3JjKGxhYmVsRW50cnkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyBzcmMsc3JjW3NyYy5sZW5ndGgtMV1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNyY1tzcmMubGVuZ3RoLTFdXG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICBpc0JsYW5rUm93ID0gZmFsc2VcblxuICAgICAgICAgICAgICAgIG5ld1Jvd1tsYWJlbEVudHJ5Lm5hbWVdID0gbmV3VmFsXG4gICAgICAgICAgICBpZiBub3QgaXNCbGFua1Jvd1xuICAgICAgICAgICAgICAgIG91dHB1dC5kYXRhLnB1c2ggbmV3Um93XG5cbiAgICAgICAgIyBjcmVhdGUgbGFiZWxzIGFycmF5XG4gICAgICAgIGZvciBsYWJlbEVudHJ5IGluIEBsYWJlbERhdGFcblxuICAgICAgICAgICAgaWYgbGFiZWxFbnRyeS5uYW1lIGlzICdsYWJlbCdcbiAgICAgICAgICAgICAgICBjb250aW51ZVxuXG4gICAgICAgICAgICBvdXRwdXQubGFiZWxzLnB1c2ggbGFiZWxFbnRyeS5uYW1lXG5cbiAgICAgICAgY29uc29sZS5sb2cgb3V0cHV0XG5cbiAgICAgICAgcmV0dXJuIG91dHB1dFxuIl19